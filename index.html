<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>花札 スコア記録</title>
    <style>
        body {
            background-image: url('bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: auto;
        }

        .container {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .btn {
            background-color: #d4a373;
            color: white;
            padding: 10px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            width: calc(100% / 4 - 20px); /* 幅を月ボタンとテンキーで揃える */
        }

        .btn.transparent {
            opacity: 0.5;
        }

        .btn.solid {
            opacity: 1;
        }

        .score-display {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* テンキーの列を3つに設定 */
            gap: 10px; /* ボタン同士の余白を調整 */
            justify-items: center; /* 中央揃えにする */
            padding: 0 20px; /* 余白の調整 */
        }

        .keypad .btn {
            width: 100%; /* テンキーの幅を広げる */
            height: 70px; /* 高さも増加 */
            font-size: 24px;
        }

        .current-month {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .end-button {
            margin-top: 20px;
            background-color: #d4a373;
            color: white;
            font-size: 18px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        h1, h2 {
            color: #444;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <!-- ホーム画面 -->
    <div id="home-screen" class="container screen active">
        <h1>花札 スコア記録</h1>
        <p>記録する月数を選択してください</p>
        <button id="six-months" class="btn">6ヶ月</button>
        <button id="twelve-months" class="btn">12ヶ月</button>
    </div>

    <!-- ひとりモード -->
    <div id="single-player-mode" class="container screen">
        <h2>ひとりモード</h2>
        <div class="score-display">花札<span id="months-count">12</span>ヶ月　現在 <span id="total-score">0</span>点</div>
        <div id="month-buttons">
            <!-- 月ボタンがここに生成されます -->
        </div>
        <div class="current-month" id="current-month-display">1月 - 点</div> <!-- デフォルトは1月が選択 -->
        <div class="keypad" id="keypad">
            <!-- 数字キーパッド -->
            <button class="btn">1</button>
            <button class="btn">2</button>
            <button class="btn">3</button>
            <button class="btn">4</button>
            <button class="btn">5</button>
            <button class="btn">6</button>
            <button class="btn">7</button>
            <button class="btn">8</button>
            <button class="btn">9</button>
            <button class="btn">×</button> <!-- ✖︎ -->
            <button class="btn">0</button> <!-- 0 -->
            <button class="btn">✓</button> <!-- ✔︎ -->
        </div>
        <button class="end-button" id="end-button">おわり</button>
        <button id="back-to-home-1" class="btn">戻る</button> <!-- 戻るボタン追加 -->
    </div>

    <script>
        // 画面要素の取得
        const homeScreen = document.getElementById('home-screen');
        const singlePlayerMode = document.getElementById('single-player-mode');
        const singlePlayerScores = document.getElementById('single-player-scores');
        const backToHome1 = document.getElementById('back-to-home-1');

        let months = 6; // デフォルトは6ヶ月

        // 6ヶ月ボタンをクリックしたとき
        document.getElementById('six-months').addEventListener('click', function() {
            months = 6;
            document.getElementById('months-count').textContent = months; // 月数表示を更新
            console.log("6ヶ月が選択されました");
            switchToSinglePlayerMode();
        });

        // 12ヶ月ボタンをクリックしたとき
        document.getElementById('twelve-months').addEventListener('click', function() {
            months = 12;
            document.getElementById('months-count').textContent = months; // 月数表示を更新
            console.log("12ヶ月が選択されました");
            switchToSinglePlayerMode();
        });

        // ひとりモードに切り替える
        function switchToSinglePlayerMode() {
            homeScreen.classList.remove('active');
            singlePlayerMode.classList.add('active');
            generateScoreInputs(months); // スコア入力フィールドを生成
        }

        // ホームに戻る
        backToHome1.addEventListener('click', function() {
            singlePlayerMode.classList.remove('active');
            homeScreen.classList.add('active');
        });

        // スコア入力フィールドを生成する関数
        function generateScoreInputs(months) {
            const monthButtonsContainer = document.getElementById('month-buttons');
            monthButtonsContainer.innerHTML = ''; // リセット
            for (let i = 1; i <= months; i++) {
                const button = document.createElement('button');
                button.classList.add('btn');
                button.textContent = `${i}月`;

                button.addEventListener('click', function() {
                    currentMonth = i;
                    currentScore = scores[i - 1] !== null ? scores[i - 1].toString() : "";
                    updateCurrentMonthDisplay();
                });

                monthButtonsContainer.appendChild(button);
            }
        }

        let totalScore = 0;
        let scores = Array(months).fill(null);  // 各月のスコア (null は未入力)
        let currentMonth = 1;  // デフォルトは1月
        let currentScore = "";

        const currentMonthDisplay = document.getElementById('current-month-display');
        const totalScoreDisplay = document.getElementById('total-score');

        // 現在の月の表示を更新
        function updateCurrentMonthDisplay() {
            currentMonthDisplay.textContent = `${currentMonth}月 ${currentScore !== "" ? currentScore : "-"}点`; // nullの場合は"-"
        }

        // キーパッドの動作
        document.querySelectorAll('.keypad .btn').forEach(button => {
            button.addEventListener('click', function() {
                const value = button.textContent;

                if (value === '×') {
                    currentScore = ""; // 現在のスコアをリセット
                    scores[currentMonth - 1] = null; // 0ではなくnullにする
                } else if (value === '✓') {
                    // スコア確定
                    if (currentMonth !== null && currentScore !== "" && currentScore !== "0") {
                        scores[currentMonth - 1] = parseInt(currentScore, 10);
                    } else if (currentScore === "0") {
                        scores[currentMonth - 1] = 0; // 0はスコアとして扱う
                    }

                    totalScore = scores.reduce((sum, score) => sum + (score || 0), 0);
                    totalScoreDisplay.textContent = totalScore;
                } else {
                    // 数字を入力
                    if (currentScore.length < 2) { // 2桁まで入力可能
                        currentScore += value;
                    }
                }

                updateCurrentMonthDisplay();
            });
        });

        // 「おわり」ボタンの処理
        document.getElementById('end-button').addEventListener('click', function() {
            if (confirm("本当に終了しますか？")) {
                // トップに戻る処理
                scores = Array(months).fill(null);  // スコアをリセット
                totalScore = 0;
                currentMonth = 1;
                currentScore = "";
                generateScoreInputs(months);  // ボタンを再生成
                updateCurrentMonthDisplay();
                totalScoreDisplay.textContent = totalScore;
                homeScreen.classList.add('active');
                singlePlayerMode.classList.remove('active');
            }
        });

        // 初期表示を生成
        generateScoreInputs(months);
    </script>
</body>
</html>
